<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Assistência Jurídica Gratuita — Dashboard Cliente</title>

    <!-- Inter (Google Fonts) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" th:href="@{/css/style.css}"/>
    <style>
        body {
            background-color: var(--color-light-gray);
        }
        .dashboard-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 2rem;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        .sidebar {
            background-color: var(--color-white);
            border-radius: 0.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
        }
        .sidebar-profile {
            text-align: center;
            margin-bottom: 2rem;
        }
        .sidebar-profile img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 0.75rem;
        }
        .sidebar-profile h3 {
            margin: 0;
            color: var(--color-dark-blue);
        }
        .sidebar-profile p {
            color: var(--color-gray-500);
            font-size: 0.875rem;
        }
        .sidebar-nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .sidebar-nav li {
            margin-bottom: 0.5rem;
        }
        .sidebar-nav a {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-radius: 0.25rem;
            color: var(--color-gray-800);
            text-decoration: none;
            font-weight: 500;
        }
        .sidebar-nav a.active,
        .sidebar-nav a:hover {
            background-color: var(--blue-900);
            color: var(--color-white);
        }
        .sidebar-nav a svg {
            margin-right: 0.75rem;
            width: 20px;
            height: 20px;
            fill: currentColor; /* Para ícones SVG */
        }
        .sidebar-nav .btn-logout {
            background-color: #dc3545;
            color: var(--color-white);
            margin-top: 2rem;
            text-align: center;
            border: none;
        }
        .sidebar-nav .btn-logout:hover {
            background-color: #c82333;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        .card {
            background-color: var(--color-white);
            border-radius: 0.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        .card-header h2 {
            margin: 0;
            color: var(--color-dark-blue);
        }
        .case-list .case-item {
            border: 1px solid var(--color-gray-100);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .case-item:last-child {
            margin-bottom: 0;
        }
        .case-info h3 {
            margin: 0 0 0.25rem 0;
            font-size: 1rem;
            color: var(--color-dark-blue);
        }
        .case-info p {
            margin: 0;
            font-size: 0.875rem;
            color: var(--color-gray-500);
        }
        .case-status {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-weight: 600;
        }
        .status-em-andamento {
            background-color: #e0f7fa;
            color: #00796b;
        }
        .status-aguardando {
            background-color: #fffde7;
            color: #fbc02d;
        }
        .status-em-analise {
            background-color: #e3f2fd;
            color: #1976d2;
        }
        .case-date {
            font-size: 0.875rem;
            color: var(--color-gray-500);
        }

        .data-section h3 {
            color: var(--color-dark-blue);
            margin-bottom: 1rem;
        }
        .data-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .data-item label {
            display: block;
            font-size: 0.875rem;
            color: var(--color-gray-500);
            margin-bottom: 0.25rem;
        }
        .data-item p {
            margin: 0;
            font-weight: 500;
            color: var(--color-dark-gray);
        }
        .edit-button {
            background: none;
            border: none;
            color: var(--blue-600);
            cursor: pointer;
            font-weight: 500;
        }
        .edit-button:hover {
            text-decoration: underline;
        }

        .password-section input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--color-gray);
            border-radius: 0.25rem;
            margin-bottom: 1rem;
        }
        .password-section .btn-alterar-senha {
            background-color: var(--blue-900);
            color: var(--color-white);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.25rem;
            cursor: pointer;
        }
        .password-section .btn-alterar-senha:hover {
            background-color: var(--blue-600);
        }
        /* Estilo para os campos de input no modo de edição */
        .data-grid input[type="text"],
        .data-grid input[type="tel"] {
            display: none; /* Por padrão, escondido */
            padding: 0.5rem;
            border: 1px solid var(--color-gray-300); /* Borda cinza claro */
            border-radius: 0.25rem;
            width: 100%; /* Ocupa a largura total do item */
            box-sizing: border-box; /* Garante que padding e border não aumentem a largura */
        }

        /* Estilo para o modo de visualização dos dados */
        .data-grid p {
            margin: 0;
            font-weight: 500;
            color: var(--color-dark-blue); /* Mantém a cor original dos dados */
        }

    </style>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const editButton = document.getElementById('edit-button');
            const saveButton = document.getElementById('save-button');
            const dataForm = document.getElementById('data-form');
            const viewElements = document.querySelectorAll('[id$="-view"]');
            const editElements = document.querySelectorAll('[id$="-edit"]');

            function toggleEditMode(isEditing) {
                viewElements.forEach(el => {
                    el.style.display = isEditing ? 'none' : 'block';
                });
                editElements.forEach(el => {
                    el.style.display = isEditing ? 'block' : 'none';
                    // Desabilita os campos de edição no modo de visualização
                    if (isEditing) {
                        el.removeAttribute('disabled');
                    } else {
                        el.setAttribute('disabled', 'disabled');
                    }
                });
                editButton.style.display = isEditing ? 'none' : 'block';
                saveButton.style.display = isEditing ? 'block' : 'none';
            }

            // Inicializa no modo de visualização (garantindo que os campos de edição estão desabilitados)
            toggleEditMode(false);

            editButton.addEventListener('click', function() {
                toggleEditMode(true);
            });

            saveButton.addEventListener('click', function() {
                // Ao clicar em Salvar, o formulário é submetido
                dataForm.submit();
            });

            // Lógica para exibir a mensagem de sucesso/erro como um alert
            const mensagemSucesso = '[[${mensagemSucesso}]]';
            const mensagemErro = '[[${mensagemErro}]]';

            if (mensagemSucesso && mensagemSucesso.trim() !== '' && mensagemSucesso !== 'null') {
                alert(mensagemSucesso);
            }
            if (mensagemErro && mensagemErro.trim() !== '' && mensagemErro !== 'null') {
                alert(mensagemErro);
            }
        });
    </script>

</head>


<body>
<!-- Header -->
<header class="site-header">
    <div class="container header-inner">
        <a th:href="@{/}" class="brand">
            <img th:src="@{/img/logo.png}" alt="Logo Assistência Jurídica Gratuita" class="brand-logo">
            <span class="brand-name">ASSISTÊNCIA JURÍDICA GRATUITA</span>
        </a>

        <button class="nav-toggle" aria-controls="site-nav" aria-expanded="false" onclick="toggleNav()">☰</button>

        <nav id="site-nav" class="site-nav">
            <a th:href="@{/como-funciona}">Como funciona</a>
            <a th:href="@{/quem-atendemos}">Quem atendemos</a>
            <a th:href="@{/areas}">Áreas de atuação</a>
            <a th:href="@{/entrar}" class="btn btn-ghost">Entrar</a>
        </nav>
    </div>
    <!-- Mensagens de Feedback -->
    <div th:if="${mensagemSucesso}" class="alert alert-success" style="margin-bottom: 2rem;">
        <p th:text="${mensagemSucesso}"></p>
    </div>
    <div th:if="${mensagemErro}" class="alert alert-danger" style="margin-bottom: 2rem;">
        <p th:text="${mensagemErro}"></p>
    </div>

</header>

<main class="dashboard-container">
    <aside class="sidebar">
        <div class="sidebar-profile">
            <img th:src="@{/img/user-avatar.png}" alt="Foto de Perfil">
            <h3 th:text="${cliente.nome}">Usuário da Silva</h3>
            <p th:text="${cliente.email}">email@email.com</p>
        </div>

        <nav class="sidebar-nav">
            <ul>
                <li><a th:href="@{/cliente/dashboard}" class="active">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                    </svg>
                    Início</a></li>
                <li><a th:href="@{/cliente/solicitacoes/historico}">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V5h14v16z"/>
                    </svg>
                    Meus Casos</a></li>
                <li><a th:href="@{/cliente/perfil}">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                    Perfil</a></li>
                <li><a th:href="@{/cliente/seguranca}">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h-1V15h2v-3.01h-1zm.5-7.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
                    </svg>
                    Segurança</a></li>
            </ul>
            <form th:action="@{/logout}" method="post">
                <button type="submit" class="btn btn-logout">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
                    </svg>
                    Sair
                </button>
            </form>
        </nav>
    </aside>

    <div class="main-content">
        <div class="card">
            <div class="card-header">
                <h2>Casos Abertos</h2>
                <a th:href="@{/cliente/solicitacao/nova}" class="btn btn-primary">Registrar Nova Solicitação</a>
            </div>
            <div class="case-list">
                <!-- Exemplo de caso em andamento -->
                <div class="case-item">
                    <div class="case-info">
                        <h3>Caso #001 <span class="case-status status-em-andamento">Em andamento</span></h3>
                        <p>Revisão de Aposentadoria</p>
                        <p class="muted">Previdenciário</p>
                    </div>
                    <span class="case-date">15/03/2024</span>
                </div>
                <!-- Exemplo de caso aguardando documentação -->
                <div class="case-item">
                    <div class="case-info">
                        <h3>Caso #002 <span class="case-status status-aguardando">Aguardando documentação</span></h3>
                        <p>Ação Trabalhista</p>
                        <p class="muted">Trabalhista</p>
                    </div>
                    <span class="case-date">22/02/2024</span>
                </div>
                <!-- Exemplo de caso em análise -->
                <div class="case-item">
                    <div class="case-info">
                        <h3>Caso #003 <span class="case-status status-em-analise">Em análise</span></h3>
                        <p>Divórcio Consensual</p>
                        <p class="muted">Civil</p>
                    </div>
                    <span class="case-date">10/01/2024</span>
                </div>
                <!-- Adicionar loop Thymeleaf para casos reais aqui -->
            </div>
        </div>


        <div class="card">
            <div class="card-header">
                <h2>Meus Dados</h2>
                <button id="edit-button" class="edit-button">Editar</button>
                <button id="save-button" class="edit-button" style="display: none;">Salvar Mudanças</button>
            </div>
            <!-- O formulário agora usa th:object="${cliente}" e th:field -->
            <form id="data-form" th:action="@{/cliente/dados/editar}" th:object="${cliente}" method="post">
                <div class="data-grid">
                    <!-- Nome Completo (Editável) -->
                    <div class="data-item">
                        <label for="nome">Nome Completo</label>
                        <p id="nome-view" th:text="*{nome}">Usuário da Silva</p>
                        <!-- Usamos th:field para gerar id, name e value -->
                        <input type="text" th:field="*{nome}" id="nome-edit" required>
                    </div>
                    <!-- E-mail (Somente Leitura) -->
                    <div class="data-item">
                        <label>E-mail</label>
                        <p th:text="*{email}">email@email.com</p>
                        <!-- Campo de input escondido e desabilitado, apenas para fins de estrutura -->
                        <input type="email" th:value="*{email}" readonly disabled style="display: none; background-color: #f0f0f0;">
                    </div>
                    <!-- Telefone (Editável) -->
                    <div class="data-item">
                        <label for="telefone">Telefone</label>
                        <p id="telefone-view" th:text="*{telefone}">(11) 98765-4321</p>
                        <!-- Usamos th:field para gerar id, name e value -->
                        <input type="tel" th:field="*{telefone}" id="telefone-edit">
                    </div>
                    <!-- CPF (Somente Leitura) -->
                    <div class="data-item">
                        <label>CPF</label>
                        <p th:text="*{cpf}">123.456.789-00</p>
                        <!-- Campo de input escondido e desabilitado, apenas para fins de estrutura -->
                        <input type="text" th:value="*{cpf}" readonly disabled style="display: none; background-color: #f0f0f0;">
                    </div>
                    <!-- Endereço (Editável) -->
                    <div class="data-item" style="grid-column: span 2;">
                        <label for="endereco">Endereço</label>
                        <p id="endereco-view" th:text="*{endereco}">Rua Exemplo, 123 - São Paulo, SP</p>
                        <!-- Usamos th:field para gerar id, name e value -->
                        <input type="text" th:field="*{endereco}" id="endereco-edit">
                    </div>
                </div>
            </form>
        </div>




        <div class="card password-section">
            <h2>Alterar Senha</h2>
            <form th:action="@{/cliente/alterar-senha}" method="post">
                <label class="sr-only" for="senhaAtual">Senha Atual</label>
                <input type="password" id="senhaAtual" name="senhaAtual" placeholder="Senha Atual" required/>
                <label class="sr-only" for="novaSenha">Nova Senha</label>
                <input type="password" id="novaSenha" name="novaSenha" placeholder="Nova Senha" required/>
                <label class="sr-only" for="confirmarNovaSenha">Confirmar Nova Senha</label>
                <input type="password" id="confirmarNovaSenha" name="confirmarNovaSenha"
                       placeholder="Confirmar Nova Senha" required/>
                <button type="submit" class="btn btn-alterar-senha">Alterar Senha</button>
            </form>
        </div>
    </div>
</main>

<!-- Footer -->
<footer class="site-footer">
    <div class="container">
        <nav class="footer-nav">
            <a th:href="@{/contato}">Contato</a>
            <a th:href="@{/termos}">Termos</a>
            <a th:href="@{/acessibilidade}">Acessibilidade</a>
            <a th:href="@{/aviso-legal}">Aviso Legal</a>
            <a th:href="@{/lgpd}">LGPD</a>
        </nav>
        <p class="copyright">© <span th:text="${#dates.format(#dates.createNow(),'yyyy')}"></span> Assistência Jurídica
            Gratuita</p>
    </div>
</footer>

<script th:src="@{/js/app.js}"></script>
</body>
</html>